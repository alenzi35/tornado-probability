<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>RAP Tornado Probability (LCC)</title>
  <style>
    body { margin: 0; }
    canvas { display: block; width: 100vw; height: 100vh; }
  </style>
</head>
<body>
<canvas id="mapCanvas"></canvas>

<script>
const canvas = document.getElementById('mapCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Load LCC JSON
fetch('map/data/tornado_prob_lcc.json')
  .then(res => res.json())
  .then(data => {
    const features = data.features;

    // Compute bounds
    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
    features.forEach(f => {
      if(f.x < minX) minX = f.x;
      if(f.x > maxX) maxX = f.x;
      if(f.y < minY) minY = f.y;
      if(f.y > maxY) maxY = f.y;
    });

    const rangeX = maxX - minX;
    const rangeY = maxY - minY;

    // Draw each point as a rectangle
    const maxPoints = 50000; // limit for performance
    const step = Math.ceil(features.length / maxPoints);

    features.forEach((f, idx) => {
      if(idx % step !== 0) return;

      // Normalize coordinates to canvas
      const px = ((f.x - minX) / rangeX) * canvas.width;
      const py = canvas.height - ((f.y - minY) / rangeY) * canvas.height; // flip Y

      // Color based on probability
      const red = Math.floor(255 * f.prob);
      const blue = Math.floor(255 * (1 - f.prob));
      ctx.fillStyle = `rgba(${red},0,${blue},0.7)`;

      // Draw a tiny rectangle for the grid point
      ctx.fillRect(px, py, 3, 3);
    });
  })
  .catch(err => console.error("Error loading LCC JSON:", err));
</script>
</body>
</html>
