<!DOCTYPE html>
<html>
<head>
  <title>RAP Tornado Probability LCC</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4/2.9.5/proj4.js"></script>
  <script src="https://unpkg.com/proj4leaflet"></script>
  <style>html,body,#map{width:100%;height:100%;margin:0}</style>
</head>
<body>
<div id="map"></div>
<script>
  // Define RAP LCC CRS
  var crs = new L.Proj.CRS('EPSG:9999',
    '+proj=lcc +lat_1=38.5 +lat_2=38.5 +lat_0=38.5 +lon_0=-97 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs',
    {
      resolutions: [8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1]
    }
  );

  var map = L.map('map', {crs: crs}).setView([39.5, -98.35], 2);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'© OpenStreetMap contributors'
  }).addTo(map);

  function getColor(p){
    return p>0.8 ? '#800026' :
           p>0.6 ? '#BD0026' :
           p>0.4 ? '#E31A1C' :
           p>0.2 ? '#FC4E2A' :
                   '#FFEDA0';
  }

  fetch('map/data/tornado_prob_lcc.json')
    .then(r=>r.json())
    .then(data=>{
      data.forEach(pt=>{
        L.rectangle(
          [[pt.y_min, pt.x_min],[pt.y_max, pt.x_max]],
          {fillColor:getColor(pt.prob), fillOpacity:0.7, color:'#000', weight:0.2}
        ).addTo(map);
      });
      console.log("✅ All RAP cells drawn perfectly in LCC meters");
    });
</script>
</body>
</html>
