<!DOCTYPE html>
<html>
<head>
  <title>Tornado Probability Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #map { height: 600px; margin: 20px; }
    h1, p { text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Tornado Probability Project</h1>
  <p>If you can read this, GitHub Pages is working.</p>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // ----------------------
    // CONUS bounds
    var CONUS_bounds = [[24.5, -125], [49.5, -66.5]];

    // Initialize map
    var map = L.map('map', {
        maxBounds: CONUS_bounds,
        maxBoundsViscosity: 1.0,
        minZoom: 4,
        maxZoom: 8
    }).setView([39.5, -98.35], 4);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // ----------------------
    // Layers
    var aggregateLayer = L.layerGroup().addTo(map);
    var normalLayer = L.layerGroup();

    // ----------------------
    // Helper: random probability
    function randomProb() {
      return (Math.random() * 0.002).toFixed(5); // placeholder probability
    }

    // Helper: color based on probability
    function getColor(prob) {
      var p = parseFloat(prob);
      if (p > 0.0015) return '#800026';
      else if (p > 0.001) return '#BD0026';
      else if (p > 0.0005) return '#E31A1C';
      else if (p > 0.0002) return '#FC4E2A';
      else return '#FFEDA0';
    }

    // ----------------------
    // Draw aggregate 130km cells
    var latStep = 1.18; // ~130km in degrees latitude
    var lngStep = 1.94; // ~130km in degrees longitude

    for (var lat = 24.5; lat < 49.5; lat += latStep) {
      for (var lng = -125; lng < -66.5; lng += lngStep) {
        var bounds = [[lat, lng], [lat + latStep, lng + lngStep]];
        L.rectangle(bounds, {color: "#0000FF", weight: 1, fillOpacity: 0.2})
          .addTo(aggregateLayer)
          .on('click', function(e) {
            aggregateLayer.clearLayers(); // hide aggregates
            drawNormalCells(e.target.getBounds());
          });
      }
    }

    // ----------------------
    // Draw normal 13km cells inside an aggregate
    function drawNormalCells(aggregateBounds) {
      normalLayer.clearLayers(); // clear previous normal cells
      var lat1 = aggregateBounds.getSouthWest().lat;
      var lng1 = aggregateBounds.getSouthWest().lng;
      var lat2 = aggregateBounds.getNorthEast().lat;
      var lng2 = aggregateBounds.getNorthEast().lng;

      var latStepSmall = (lat2 - lat1) / 10;
      var lngStepSmall = (lng2 - lng1) / 10;

      for (var i = 0; i < 10; i++) {
        for (var j = 0; j < 10; j++) {
          var cellBounds = [
            [lat1 + i*latStepSmall, lng1 + j*lngStepSmall],
            [lat1 + (i+1)*latStepSmall, lng1 + (j+1)*lngStepSmall]
          ];
          var prob = randomProb();
          L.rectangle(cellBounds, {
            fillColor: getColor(prob),
            color: "#000",
            weight: 0.5,
            fillOpacity: 0.7
          }).bindPopup(`Probability: ${prob}`).addTo(normalLayer);
        }
      }
      normalLayer.addTo(map);
    }

  </script>
</body>
</html>
