<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Interactive RAP Tornado Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  body { margin:0; }
  #map { width: 100vw; height: 100vh; }
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([39, -98], 4);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap contributors',
  maxZoom: 18
}).addTo(map);

// Load RAP JSON
fetch('map/data/tornado_prob.json')
  .then(r => r.json())
  .then(data => {
    console.log("Loaded cells:", data.length);

    data.forEach(cell => {
      // Draw rectangle for each cell
      L.rectangle(
        [
          [cell.lat_min, cell.lon_min],
          [cell.lat_max, cell.lon_max]
        ],
        {
          fillColor: getColor(cell.prob),
          fillOpacity: 0.7,
          color: '#000',
          weight: 0.3
        }
      ).addTo(map)
      .bindPopup(
        `<b>Tornado probability:</b> ${cell.prob.toFixed(3)}<br>` +
        `Lat: ${cell.lat_min.toFixed(2)}–${cell.lat_max.toFixed(2)}<br>` +
        `Lon: ${cell.lon_min.toFixed(2)}–${cell.lon_max.toFixed(2)}`
      );
    });
  })
  .catch(err => console.error(err));

// Color function
function getColor(p){
  return p > 0.8 ? '#800026' :
         p > 0.6 ? '#BD0026' :
         p > 0.4 ? '#E31A1C' :
         p > 0.2 ? '#FC4E2A' :
                   '#FFEDA0';
}
</script>

</body>
</html>
