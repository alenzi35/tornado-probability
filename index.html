<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>RAP Grid – Guaranteed Render</title>
<style>
  html, body { margin:0; background:black; overflow:hidden; }
  canvas { display:block; }
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

// radians → degrees
const RAD2DEG = 180 / Math.PI;

fetch("map/data/tornado_prob.json")
  .then(r => r.json())
  .then(data => {

    // convert + find bounds
    let minX=Infinity, maxX=-Infinity, minY=Infinity, maxY=-Infinity;

    for (const c of data) {
      c.lat_min *= RAD2DEG;
      c.lat_max *= RAD2DEG;
      c.lon_min *= RAD2DEG;
      c.lon_max *= RAD2DEG;

      minX = Math.min(minX, c.lon_min);
      maxX = Math.max(maxX, c.lon_max);
      minY = Math.min(minY, c.lat_min);
      maxY = Math.max(maxY, c.lat_max);
    }

    const scaleX = canvas.width  / (maxX - minX);
    const scaleY = canvas.height / (maxY - minY);
    const scale = Math.min(scaleX, scaleY);

    function proj(lat, lon) {
      return [
        (lon - minX) * scale,
        canvas.height - (lat - minY) * scale
      ];
    }

    for (const c of data) {
      const [x1,y1] = proj(c.lat_min, c.lon_min);
      const [x2,y2] = proj(c.lat_max, c.lon_max);

      ctx.fillStyle = `rgba(255,0,0,${c.prob})`;
      ctx.fillRect(
        Math.min(x1,x2),
        Math.min(y1,y2),
        Math.abs(x2-x1),
        Math.abs(y2-y1)
      );
    }

    console.log("✅ Rendered", data.length, "cells");
  })
  .catch(err => console.error(err));
</script>
</body>
</html>
