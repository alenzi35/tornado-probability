<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Interactive RAP Tornado Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://openseadragon.github.io/openseadragon/openseadragon.min.js"></script>
<style>
  html, body { margin:0; height:100%; }
  #openseadragon { width:100%; height:100%; background:black; }
  .popup { position:absolute; background:white; padding:4px; border:1px solid #000; pointer-events:none; }
</style>
</head>
<body>

<div id="openseadragon"></div>
<div id="popup" class="popup" style="display:none;"></div>

<script>
// --- Initialize OpenSeadragon ---
const viewer = OpenSeadragon({
    id: "openseadragon",
    prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
    tileSources: {
        type: "image",
        url: "map/data/tornado_prob.png",
        buildPyramid: false
    }
});

// --- Load JSON overlay ---
fetch("map/data/tornado_prob_pixels.json").then(r => r.json()).then(data => {
    const popup = document.getElementById("popup");

    viewer.addHandler("canvas-click", event => {
        const webPoint = event.position; // screen coordinates
        const viewportPoint = viewer.viewport.pointFromPixel(webPoint);
        const imagePoint = viewer.viewport.viewportToImageCoordinates(viewportPoint);

        // Find cell at clicked pixel
        const cell = data.find(c => {
            return imagePoint.x >= c.col && imagePoint.x < c.col + 1 &&
                   imagePoint.y >= c.row && imagePoint.y < c.row + 1;
        });

        if(cell){
            popup.style.display = "block";
            popup.style.left = (webPoint.x + 10) + "px";
            popup.style.top  = (webPoint.y + 10) + "px";
            popup.innerHTML = `Tornado probability: ${cell.prob.toFixed(3)}`;
        } else {
            popup.style.display = "none";
        }
    });
});
</script>

</body>
</html>
