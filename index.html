<!DOCTYPE html>
<html>
<head>
  <title>Tornado Probability Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin:0; background:#f4f4f4; font-family:Arial; }
    h1 { text-align:center; margin:10px 0; }
    #map { height:650px; margin:10px; border-radius:8px; }
  </style>
</head>
<body>

<h1>Tornado Probability (Raw RAP Cells)</h1>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const CONUS = [[22, -128], [51.5, -64]];

const map = L.map('map', {
  maxBounds: CONUS,
  minZoom: 4,
  maxZoom: 18
}).setView([39.5, -98.35], 4);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'Â© OpenStreetMap'
}).addTo(map);

const cellLayer = L.layerGroup().addTo(map);

function getColor(p){
  return p > 0.8 ? '#800026' :
         p > 0.6 ? '#BD0026' :
         p > 0.4 ? '#E31A1C' :
         p > 0.2 ? '#FC4E2A' :
                   '#FFEDA0';
}

fetch("map/data/tornado_prob.json")
  .then(r => r.json())
  .then(data => {
    data.forEach(pt => {

      // RAP grid spacing (km)
      const HALF_LAT = (13.545 / 111) / 2;
      const HALF_LON = HALF_LAT / Math.cos(pt.lat * Math.PI / 180);

      const bounds = [
        [pt.lat - HALF_LAT, pt.lon - HALF_LON],
        [pt.lat + HALF_LAT, pt.lon + HALF_LON]
      ];

      L.rectangle(bounds, {
        fillColor: getColor(pt.prob),
        fillOpacity: 0.6,
        color: null,
        weight: 0
      }).addTo(cellLayer);
    });

    console.log("Rendered cells:", data.length);
  })
  .catch(e => console.error(e));
</script>

</body>
</html>
