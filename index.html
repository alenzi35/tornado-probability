<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Tornado Probability Map</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
html, body {
  margin: 0;
  height: 100%;
}

#map {
  width: 100%;
  height: 100%;
}
</style>
</head>

<body>

<div id="map"></div>

<script>

// Create map centered on US
const map = L.map('map').setView([39, -98], 4);

// OpenStreetMap tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 12,
  attribution: '&copy; OpenStreetMap'
}).addTo(map);


// Load lat/lon data
fetch('map/data/tornado_prob.json')
.then(r => r.json())
.then(data => {

  data.forEach(f => {

    const lat = f.lat;
    const lon = f.lon;
    const prob = f.prob;

    // Estimate cell size from steps
    const dLat = f.latStep / 2;
    const dLon = f.lonStep / 2;

    // Color scale
    const r = Math.floor(255 * prob);
    const b = Math.floor(255 * (1 - prob));

    const color = `rgb(${r},0,${b})`;

    // Rectangle bounds
    const bounds = [
      [lat - dLat, lon - dLon],
      [lat + dLat, lon + dLon]
    ];

    const rect = L.rectangle(bounds, {
      color: color,
      weight: 0,
      fillOpacity: 0.7
    });

    rect.bindTooltip(
      `Probability: ${(prob*100).toFixed(1)}%`,
      {sticky:true}
    );

    rect.addTo(map);

  });

});
</script>

</body>
</html>
