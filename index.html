<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Interactive RAP Tornado Map</title>
  <script src="https://unpkg.com/deck.gl@~8.9.0/dist.min.js"></script>
  <script src="https://unpkg.com/ol/ol.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/ol/ol.css" />
  <style>
    body { margin:0; overflow:hidden; }
    #map { position:absolute; width:100%; height:100%; }
  </style>
</head>
<body>

<div id="map"></div>

<script type="module">
import {Map, View} from 'https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js';
import {Tile as TileLayer} from 'https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js';
import {OSM} from 'https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js';
import {DeckGL} from 'https://unpkg.com/deck.gl@8.9.0/dist.min.js';

// Create OpenLayers map for basemap
const map = new Map({
  target: 'map',
  layers: [new TileLayer({source: new OSM()})],
  view: new View({
    center: [0,0],
    zoom: 4
  })
});

// Load RAP LCC JSON
fetch('map/data/tornado_prob_lcc.json')
  .then(r => r.json())
  .then(data => {
    // Create Deck.gl layer
    const deck = new deck.DeckGL({
      canvas: 'deck-canvas',
      width: '100%',
      height: '100%',
      initialViewState: {
        longitude: -97,
        latitude: 38,
        zoom: 4,
        pitch: 0,
        bearing: 0
      },
      controller: true,
      layers: [
        new deck.GridCellLayer({
          id: 'tornado-grid',
          data: data,
          getPosition: d => [d.x, d.y, 0],
          getColor: d => {
            const p = d.prob;
            if(p>0.8) return [128,0,38];
            if(p>0.6) return [189,0,38];
            if(p>0.4) return [227,26,28];
            if(p>0.2) return [252,78,42];
            return [255,237,160];
          },
          cellSize: 13545, // 13.545 km in meters
          elevationScale: 0,
          extruded: false,
          pickable: true,
          onHover: info => {
            if(info.object) console.log('Probability:', info.object.prob);
          }
        })
      ]
    });
  });
</script>

</body>
</html>
