<!DOCTYPE html>
<html>
<head>
  <title>Interactive Tornado Probability Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#f4f4f4; }
    #map { height:90vh; width:100%; }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ------------------ SETUP ------------------
var map = L.map('map', {
    center: [39.5, -98.35],
    zoom: 4,
    minZoom: 4,
    maxZoom: 18
});

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'© OpenStreetMap contributors'
}).addTo(map);

// ------------------ COLOR SCALE ------------------
function getColor(p){
    if(p>0.8) return '#800026';
    if(p>0.6) return '#BD0026';
    if(p>0.4) return '#E31A1C';
    if(p>0.2) return '#FC4E2A';
    return '#FFEDA0';
}

// ------------------ LOAD JSON ------------------
fetch("map/data/tornado_prob.json")
  .then(resp => resp.json())
  .then(data => drawCells(data))
  .catch(err => console.error("Failed to load JSON:", err));

// ------------------ DRAW CELLS ------------------
function drawCells(jsonData){
    // Approx conversion from 13.545 km → degrees
    // 1 deg latitude ≈ 111 km
    var cellSizeLat = 13.545 / 111; 
    var cellLayer = L.layerGroup().addTo(map);

    jsonData.forEach(pt => {
        var lat1 = pt.lat;
        var lon1 = pt.lon;
        var lat2 = pt.lat + cellSizeLat;
        // adjust longitude for convergence
        var lon2 = pt.lon + cellSizeLat / Math.cos(pt.lat * Math.PI/180);

        var rect = L.rectangle(
            [[lat1, lon1], [lat2, lon2]],
            {fillColor: getColor(pt.prob), fillOpacity: 0.6, color:'#000', weight:0.2}
        ).addTo(cellLayer);

        rect.bindPopup(`<b>Probability:</b> ${pt.prob.toFixed(3)}<br>Lat: ${pt.lat.toFixed(3)}, Lon: ${pt.lon.toFixed(3)}`);
    });
}
</script>

</body>
</html>
