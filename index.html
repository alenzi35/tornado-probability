<!DOCTYPE html>
<html>
<head>
  <title>Tornado Probability Map</title>
  <link rel="stylesheet" href="https://unpkg.com" />
  <style>
    body { margin:0; }
    #map { height: 100vh; background: #0b0b0b; }
  </style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com"></script>
<script>
var map = L.map('map', { 
    preferCanvas: true, // Required for performance
    minZoom: 4 
}).setView([39.5, -98.35], 5);

L.tileLayer('https://{s}://{z}/{x}/{y}{r}.png').addTo(map);

function getColor(p) {
    return p > 0.15 ? '#800026' : p > 0.05 ? '#E31A1C' : p > 0.02 ? '#FC4E2A' : '#FFEDA0';
}

fetch("map/data/tornado_prob.json")
  .then(res => res.json())
  .then(data => {
      const { d_lat, d_lon } = data.meta;
      data.cells.forEach(pt => {
          // Half-offset centers the rectangle on the coordinate
          let bounds = [
              [pt.lt - d_lat/2, pt.ln - d_lon/2], 
              [pt.lt + d_lat/2, pt.ln + d_lon/2]
          ];
          L.rectangle(bounds, {
              fillColor: getColor(pt.p),
              fillOpacity: 0.5,
              weight: 0, // Removes the border gap
              interactive: false
          }).addTo(map);
      });
  });
</script>
</body>
</html>
