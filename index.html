<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>RAP Native Grid Viewer</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="map"></canvas>

<script>
const canvas = document.getElementById("map");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let scale = 0.00015;      // meters â†’ pixels
let offsetX = canvas.width / 2;
let offsetY = canvas.height / 2;

let dragging = false;
let lastX, lastY;

function worldToScreen(x, y) {
  return [
    x * scale + offsetX,
    -y * scale + offsetY
  ];
}

function drawCell(cell, size) {
  const [sx, sy] = worldToScreen(cell.x, cell.y);
  const px = size * scale;

  ctx.fillStyle = `rgba(255,0,0,${cell.value})`;
  ctx.fillRect(
    sx - px / 2,
    sy - px / 2,
    px,
    px
  );
}

fetch("map/data/rap_lcc.json")
  .then(r => r.json())
  .then(data => {
    const size = data.dx;

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (const cell of data.cells) {
        drawCell(cell, size);
      }
      requestAnimationFrame(render);
    }
    render();
  });

// --- Interaction ---
canvas.addEventListener("mousedown", e => {
  dragging = true;
  lastX = e.clientX;
  lastY = e.clientY;
});

canvas.addEventListener("mouseup", () => dragging = false);
canvas.addEventListener("mouseleave", () => dragging = false);

canvas.addEventListener("mousemove", e => {
  if (!dragging) return;
  offsetX += e.clientX - lastX;
  offsetY += e.clientY - lastY;
  lastX = e.clientX;
  lastY = e.clientY;
});

canvas.addEventListener("wheel", e => {
  const zoom = e.deltaY < 0 ? 1.1 : 0.9;
  scale *= zoom;
});
</script>
</body>
</html>
